#!/bin/zsh

# 起動時フラグファイルのパス
FLAG_FILE="$HOME/.ascii_shown_$(date +%Y%m%d)"

# 今日まだ表示していない場合のみ実行
if [[ ! -f "$FLAG_FILE" ]]; then
    # 古いフラグファイルを削除
    rm -f "$HOME"/.ascii_shown_*
    
    # ASCIIアートの定義
    ascii_art=(
        "██╗    ██╗███████╗██╗      ██████╗ ██████╗ ███╗   ███╗███████╗"
        "██║    ██║██╔════╝██║     ██╔════╝██╔═══██╗████╗ ████║██╔════╝"
        "██║ █╗ ██║█████╗  ██║     ██║     ██║   ██║██╔████╔██║█████╗  "
        "██║███╗██║██╔══╝  ██║     ██║     ██║   ██║██║╚██╔╝██║██╔══╝  "
        "╚███╔███╔╝███████╗███████╗╚██████╗╚██████╔╝██║ ╚═╝ ██║███████╗"
        " ╚══╝╚══╝ ╚══════╝╚══════╝ ╚═════╝ ╚═════╝ ╚═╝     ╚═╝╚══════╝"
        "                                                                "
        "         ████████╗ ██████╗     ███████╗███████╗██╗  ██╗        "
        "         ╚══██╔══╝██╔═══██╗    ╚══███╔╝██╔════╝██║  ██║        "
        "            ██║   ██║   ██║      ███╔╝ ███████╗███████║        "
        "            ██║   ██║   ██║     ███╔╝  ╚════██║██╔══██║        "
        "            ██║   ╚██████╔╝    ███████╗███████║██║  ██║        "
        "            ╚═╝    ╚═════╝     ╚══════╝╚══════╝╚═╝  ╚═╝        "
    )
    
    # 画面をクリア
    clear
    
    # カーソルを非表示
    tput civis
    
    # 色の定義（シアン）
    echo -en "\033[36m"
    
    # アニメーション: 上から1行ずつ表示
    for line in "${ascii_art[@]}"; do
        echo "$line"
        sleep 0.08
    done
    
    # 色をリセット
    echo -en "\033[0m"
    
    # カーソルを表示
    tput cnorm
    
    # 少し待機
    sleep 1
    
    # ミラーサーバー更新
    echo ""
    echo -e "\033[33m⚡ ミラーサーバーを更新中...\033[0m"
    echo ""
    
    if sudo reflector --country 'Japan' --age 24 --protocol https --sort rate --save /etc/pacman.d/mirrorlist 2>/dev/null; then
        echo ""
        echo -e "\033[32m✓ ミラーサーバー更新完了\033[0m"
        echo ""
    else
        echo ""
        echo -e "\033[31m✗ ミラーサーバー更新に失敗しました\033[0m"
        echo ""
    fi
    
    sleep 0.5
    
    # フラグファイルを作成
    touch "$FLAG_FILE"
fi
